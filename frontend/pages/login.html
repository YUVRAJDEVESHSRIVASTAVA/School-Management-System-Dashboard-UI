<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Login ‚Äì School ERP</title>
	<link rel="stylesheet" href="../assets/css/login.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="auth-bg">

	<div class="auth-card">
		<div class="auth-logo">üè´ School ERP</div>
		<div class="auth-sub">Sign in to your account</div>

		<div class="role-tabs">
			<button class="role-tab active" id="tabStudent" onclick="switchRole('student')">
				<i class="fa fa-user-graduate"></i> Student
			</button>
			<button class="role-tab" id="tabTeacher" onclick="switchRole('teacher')">
				<i class="fa fa-chalkboard-teacher"></i> Teacher
			</button>
		</div>

		<div id="errorMsg" class="auth-error"></div>

		<form class="auth-form" id="loginForm" onsubmit="handleLogin(event)">
			<input type="hidden" id="selectedRole" value="student">

			<div class="form-group">
				<label for="username">Username</label>
				<input type="text" id="username" placeholder="Enter username" required>
			</div>

			<div class="form-group">
				<label for="password">Password</label>
				<input type="password" id="password" placeholder="Enter password" required>
			</div>

			<button type="submit" class="auth-btn">Login</button>
		</form>

		<div class="auth-footer">
			Don't have an account? <a href="register.html">Register here</a>
		</div>
	</div>

	<script src="../assets/js/login.js"></script>
	<script>
		// Redirect if already logged in
		const s = JSON.parse(localStorage.getItem("school_session") || "null");
		if (s) {
			window.location.href = s.role === "teacher" ? "teacher-dashboard.html" : "students/student-list.html";
		}

		function switchRole(role) {
			document.getElementById("selectedRole").value = role;
			document.getElementById("tabStudent").classList.toggle("active", role === "student");
			document.getElementById("tabTeacher").classList.toggle("active", role === "teacher");
		}

		async function handleLogin(event) {
			event.preventDefault();
			const username = document.getElementById("username").value.trim();
			const password = document.getElementById("password").value;
			const role     = document.getElementById("selectedRole").value;
			const errBox   = document.getElementById("errorMsg");
			const btn      = document.querySelector("button[type=submit]");

			btn.disabled    = true;
			btn.textContent = "Signing in‚Ä¶";
			errBox.style.display = "none";

			const result = await loginUser(username, password, role);
			btn.disabled    = false;
			btn.textContent = "Login";

			if (result.ok) {
				window.location.href = role === "teacher" ? "teacher-dashboard.html" : "students/student-list.html";
			} else {
				errBox.textContent = result.message;
				errBox.style.display = "block";
			}
		}
	</script>
</body>
</html>